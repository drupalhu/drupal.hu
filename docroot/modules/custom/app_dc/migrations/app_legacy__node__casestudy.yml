langcode: 'en'
status: true
id: 'app_legacy__node__casestudy'
label: 'App - Legacy - node:casestudy'

migration_group: 'app_legacy'
migration_tags:
  - 'src_node'
  - 'src_node__link'
  - 'dst_node'
  - 'dst_node__casestudy'

migration_dependencies:
  required:
    - 'app_legacy__file__public'
    - 'app_legacy__user__user'
    - 'app_legacy__media__image__webshot'

source:
  plugin: 'd7_node'
  node_type: 'link'
  constants:
    teaser_text_format: 'html_teaser'
    body_text_format: 'html_body'
    langcode: 'hu'
    default_langcode: true
    links_options: 'a:0:{}'

process:
  langcode: 'constants/langcode'
  default_langcode: 'constants/default_langcode'
  nid: 'nid'
  vid: 'vid'
  uid:
    -
      source: 'node_uid'
      plugin: 'skip_on_empty'
      method: 'process'
    -
      plugin: 'migration_lookup'
      migration:
        - 'app_legacy__user__user'
  status: 'status'
  created: 'created'
  changed: 'changed'
  promote: 'promote'
  sticky: 'sticky'
  revision_uid:
    -
      source: 'revision_uid'
      plugin: 'skip_on_empty'
      method: 'process'
    -
      plugin: 'migration_lookup'
      migration:
        - 'app_legacy__user__user'
  revision_log: 'log'
  revision_timestamp: 'timestamp'

  title: 'title'

  app_image:
    -
      source: 'field_webshot/0/fid'
      plugin: 'migration_lookup'
      no_stub: true
      migration:
        - 'app_legacy__media__image__webshot'
    -
      plugin: 'skip_on_empty'
      method: 'process'

  _app_teaser_value:
    source:
      - 'body/0/summary'
      - 'body/0/value'
    plugin: 'app_non_empty'
  app_teaser/0/value: '@_app_teaser_value'
  app_teaser/0/format: 'constants/teaser_text_format'

  app_body/0/value:
    source:
      - '@_app_teaser_value'
      - ''
      - 'body/0/value'
    plugin: 'callback'
    callable: 'str_replace'
    unpack_source: true
  app_body/0/format: 'constants/body_text_format'

  app_links:
    source: 'field_link'
    plugin: 'sub_process'
    process:
      uri:
        source: 'url'
        plugin: 'skip_on_empty'
        method: 'process'
      title: 'title'
      options: 'constants/links_options'

destination:
  plugin: 'entity:node'
  default_bundle: 'casestudy'
